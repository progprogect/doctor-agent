# MVP проекта: AI-агент для доктора  
(Instagram-first, Web Chat MVP, Privacy-first)

---

## 1. Цель проекта

Разработать MVP AI-агента, который выполняет роль цифрового ассистента врача и ведёт первичную коммуникацию с пациентами в формате чата.

Агент предназначен для:
- информирования пациентов;
- навигации по услугам и процессу приёма;
- предварительной записи;
- фильтрации запросов и эскалации диалогов человеку.

На этапе MVP агент тестируется через **веб-интерфейс чата**.  
Интеграция с Instagram и другими каналами рассматривается как следующий этап.

---

## 2. Область MVP (Scope)

### 2.1. Что входит в MVP

- Один тип агента: **AI-агент конкретного доктора**
- Один канал коммуникации: **Web Chat**
- Backend API
- LLM-агент (LangChain)
- RAG (Retrieval-Augmented Generation)
- Административная панель (MVP)
- Реалтайм-перехват диалогов человеком
- Временное хранение сообщений (до 48 часов)
- Аудит административных действий

---

### 2.2. Что НЕ входит в MVP

- Прямая интеграция с Instagram API
- Онлайн-календарь и автоматическая запись
- CRM-интеграции
- Платежи и биллинг
- Мультиканальная коммуникация
- Многоязычная поддержка
- Обучение или дообучение моделей

---

## 3. Концепция агента

### 3.1. Общая идея

Каждый AI-агент:
- соответствует **одному врачу**;
- полностью описывается конфигурацией (`AgentConfig`);
- создаётся и настраивается через административную форму;
- не требует изменения кода при создании нового агента.

Новый агент = новая конфигурация + набор документов для RAG.

---

### 3.2. Роль агента

AI-агент:
- отвечает на общие вопросы о враче и клинике;
- предоставляет информацию об услугах (без медицинских рекомендаций);
- объясняет процесс приёма;
- выявляет намерение записи;
- собирает контактные данные по запросу пользователя;
- определяет ситуации, требующие участия человека;
- корректно завершает диалог после передачи человеку.

---

## 4. Ограничения и правила безопасности

AI-агент **категорически запрещён** к:
- постановке диагнозов;
- интерпретации медицинских анализов;
- рекомендациям лечения или препаратов;
- советам по медицинским решениям;
- замене консультации врача.

### Обязательная эскалация к человеку:
- срочные или тревожные симптомы;
- жалобы на боль, кровотечение, ухудшение состояния;
- любые медицинские вопросы;
- повторные пациенты;
- запрос на запись к врачу;
- предоставление номера телефона или другого контакта.

После передачи диалога человеку:
- AI-агент **полностью прекращает участие в диалоге**.

---

## 5. Архитектура MVP (логическая)

### 5.1. Основные компоненты

1. **Web Chat**
   - интерфейс общения пользователя с агентом;
   - поддержка real-time сообщений;
   - отображение статуса диалога.

2. **Backend API**
   - обработка сообщений;
   - управление агентами;
   - логика эскалации;
   - контроль доступа.

3. **LLM-агент**
   - реализован через LangChain;
   - использует системные инструкции, политики и RAG;
   - не хранит состояние вне backend.

4. **RAG-хранилище**
   - документы конкретного врача;
   - используется строго в рамках одного агента.

5. **Административная панель**
   - просмотр активных диалогов в реальном времени;
   - перехват диалогов;
   - настройка агентов;
   - аудит действий.

---

## 6. Конфигурация агента (AgentConfig)

Каждый агент описывается конфигурацией, включающей:

### 6.1. Профиль врача
- имя и отображаемое имя;
- специализация;
- язык общения;
- стиль и тональность;
- уровень формальности.

### 6.2. Политики и правила
- запрещённые темы;
- триггеры эскалации;
- сценарий записи;
- правила прекращения диалога AI.

### 6.3. Материалы для RAG
- информация о враче;
- описание услуг;
- FAQ;
- адрес и часы работы;
- процесс приёма;
- скрипты ответов.

---

## 7. Административная панель (MVP)

### Функции:
- создание и редактирование агентов;
- загрузка и обновление материалов RAG;
- просмотр активных диалогов;
- real-time перехват диалога человеком;
- возврат диалога AI (если применимо);
- базовая статистика;
- журнал аудита.

---

## 8. Статусы диалога

Каждый диалог имеет один из статусов:
- `AI_ACTIVE` — отвечает AI-агент;
- `NEEDS_HUMAN` — агент запросил вмешательство человека;
- `HUMAN_ACTIVE` — диалог ведёт администратор;
- `CLOSED` — диалог завершён.

---

## 9. Хранение данных и конфиденциальность (Privacy-first)

Система проектируется с приоритетом соблюдения требований законодательства о защите персональных данных.

### 9.1. Временное хранение сообщений

Текстовые сообщения диалога:
- хранятся **временно**, исключительно для обеспечения работы активного диалога и перехвата;
- срок хранения: **до 48 часов**;
- после истечения срока сообщения **автоматически и безвозвратно удаляются**;
- используется механизм TTL (time-to-live).

Сообщения:
- не используются для обучения моделей;
- не анализируются после удаления;
- не восстанавливаются.

---

### 9.2. Реалтайм-доступ без постоянного хранения

Администратор может:
- подключиться к активному диалогу;
- видеть сообщения **в реальном времени**;
- перехватить управление диалогом.

После удаления сообщений:
- доступ к полному тексту диалога отсутствует.

---

### 9.3. Обезличенные метаданные

На постоянной основе могут храниться **только обезличенные метаданные**, включая:
- agent_id;
- временные метки начала и завершения диалога;
- статус диалога;
- тип запроса (информация / запись / эскалация);
- факт передачи диалога человеку.

Эти данные не содержат персональной информации.

---

### 9.4. Контактные данные пользователя

Контактные данные:
- запрашиваются только при явном согласии пользователя;
- используются исключительно для передачи администратору;
- не участвуют в дальнейшем диалоге AI.

После получения контакта:
- AI-агент немедленно прекращает коммуникацию;
- дальнейшее общение ведёт человек.

---

### 9.5. Аудит и контроль

Все административные действия:
- логируются;
- не содержат персональных данных пользователей;
- доступны только авторизованным ролям.

---

## 10. Будущее развитие (не MVP)

- Интеграция с Instagram
- Дополнительные каналы (WhatsApp, Telegram)
- CRM-интеграция
- Онлайн-запись
- Расширенная аналитика
- Многоагентная архитектура

---

## 11. Результат MVP

Результатом MVP является система, в которой:
- AI-агент безопасен с медицинской и юридической точки зрения;
- персональные данные не хранятся дольше допустимого срока;
- администратор может контролировать диалоги в реальном времени;
- агент создаётся через форму без изменения кода;
- архитектура готова к масштабированию и новым каналам.
